#  docker compose file for Node.js application
#   node:
#     build:
#       context: .
#       dockerfile: Dockerfile-node
#     container_name: local_node
#     restart: unless-stopped
#     ports:
#       - "3000:3000"
#     volumes:
#       - ./server:/app/server
#       - ./public:/app/public
#       - ./package.json:/app/package.json
#       - ./package-lock.json:/app/package-lock.json
#       - node_modules:/app/node_modules
#     networks:
#       - postgres_network
#     depends_on:
#       postgres:
#         condition: service_healthy
#       redis:
#         condition: service_healthy
#     env_file:
#       - .env

# package.json 
# {
#     "name": "vanilla-es6-node-template",
#     "version": "1.0.0",
#     "type": "module",
#     "scripts": {
#         "dev": "nodemon --delay 2 server/server.js",
#         "build": "node esbuild.config.js"
#     },
#     "dependencies": {
#         "ali-oss": "^6.1.0",
#         "connect-livereload": "^0.6.1",
#         "cookie-parser": "^1.4.7",
#         "cors": "^2.8.5",
#         "dotenv": "^17.2.0",
#         "express": "^4.18.2",
#         "express-rate-limit": "^8.0.1",
#         "express-validator": "^7.2.1",
#         "formidable": "^3.5.4",
#         "helmet": "^8.1.0",
#         "jsonwebtoken": "^9.0.2",
#         "jspdf-html2canvas": "^1.5.2",
#         "livereload": "^0.9.3",
#         "mime-types": "^3.0.1",
#         "multer": "^2.0.2",
#         "nodemailer": "^7.0.5",
#         "pdfkit": "^0.17.1",
#         "pg": "^8.16.3",
#         "playwright": "^1.54.2",
#         "redis": "^5.6.0",
#         "sharp": "^0.34.3",
#         "uuid": "^11.1.0"
#     },
#     "devDependencies": {
#         "esbuild": "^0.25.8",
#         "nodemon": "^3.1.10"
#     }
# }

FROM node:24-slim

# Install system dependencies for Playwright
RUN apt-get update && apt-get install -y \
    wget \
    ca-certificates \
    fonts-liberation \
    libasound2 \
    libatk-bridge2.0-0 \
    libatk1.0-0 \
    libcups2 \
    libdbus-1-3 \
    libdrm2 \
    libgbm1 \
    libgtk-3-0 \
    libnspr4 \
    libnss3 \
    libx11-xcb1 \
    libxcomposite1 \
    libxdamage1 \
    libxrandr2 \
    xdg-utils \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm install
RUN npx playwright install
RUN npx playwright install chromium

# Copy application code
COPY . .

# Expose port
EXPOSE 3000

# Start development server
CMD ["npm", "run", "dev"]